define(function(require,module,exports){require("jquery"),require("underscore"),require("layDate"),require("layer"),require("layerCss"),$(function(){var App=function(){this.url={addElevatorUrl:"addElevator.html"},this.tpl={subWraperTpl:_.template($("#subWraperTpl").html()),elevatorItemTpl:_.template($("#elevatorItemTpl").html())},this.elevatorData={subHouseLists:[]},this.init(),this.citySelect(),this.dateSelect(),this.addHouse(),this.addSubhouse(),this.addElevator(),this.addElevatorWall(),this.submitElevator()};App.prototype={init:function(){},citySelect:function(){require.async("cxSelect",function(){$("#groupSelect").cxSelect({url:"js/plugin/cxSelect/cityData.min.js",selects:["province","city","area"]})})},dateSelect:function(){var start={elem:"#cooperStart",format:"YYYY-MM-DD",choose:function(datas){end.min=datas,end.start=datas}},end={elem:"#cooperEnd",format:"YYYY-MM-DD",choose:function(datas){start.max=datas}};laydate(start),laydate(end)},addHouse:function(){var self=this;require.async("jqueryForm",function(){require.async("jqueryValidate",function(){self.validate=$("#addForm").validate({rules:{city:{required:!0},area:{required:!0},cooperStart:{required:!0},cooperEnd:{required:!0},loupan:{required:!0}},messages:{city:{required:"城市为必填项"},area:{required:"区域为必填项"},cooperStart:{required:"合作期限不能为空"},cooperEnd:{required:"合作期限不能为空"},loupan:{required:"楼盘为必填项"}},errorPlacement:function(error,element){$("#formError").html(error)},submitHandler:function(form){var $province=$("#province"),$city=$("#city"),$area=$("#area"),$address=$("#address"),$cooperStart=$("#cooperStart"),$cooperEnd=$("#cooperEnd"),$loupan=$("#loupan");$("#mainName").text($loupan.val()),$("#mainTime").text($cooperStart.val()+"——"+$cooperEnd.val()),$("#mainArress").text($province.val()+$city.val()+$area.val());var data=self.elevatorData;data.province=$province.val(),data.city=$city.val(),data.area=$area.val(),data.address=$address.val(),data.cooperStart=$cooperStart.val(),data.cooperEnd=$cooperEnd.val(),data.loupanName=$loupan.val(),console.log(data),$("#addForm").slideUp(),$("#addWraper").slideDown()}})})})},addSubhouse:function(){$("#addSubHouseBtn").on("click",function(){layer.open({title:"新增子楼",type:2,area:["400px","300px"],fix:!1,maxmin:!0,content:"addSubHouse.hbs"})})},createSubhouse:function(subName){var self=this,data={houseName:subName,houseTimeStap:1*new Date,elevatorLists:[]};self.elevatorData.subHouseLists.push(data);var html=self.tpl.subWraperTpl(data);$("#elevatorContainer").append(html)},addElevator:function(){$("body").on("click",".addElevatorBtn",function(){var timestap=$(this).attr("data-house-timestap"),house=$(this).attr("data-house");layer.open({title:"为==>"+house+"  ==新增电梯",type:2,area:["600px","300px"],fix:!1,maxmin:!0,content:"addElevator.hbs?houseTimeStap="+timestap})})},createElevator:function(data){var self=this,html=self.tpl.elevatorItemTpl(data);console.log(data,html),$("#"+data.houseTimeStap).append(html);for(var elevatorName=data.elevatorName,elevatorNum=data.elevatorNum,elevatorData={elevatorTimeStap:data.elevatorTimeStap,elevatorName:data.elevatorName,wallLists:[]},i=0;i<elevatorNum;i++){var wallData={wallName:elevatorName+"——》"+i,index:i};elevatorData.wallLists.push(wallData)}self.elevatorData.subHouseLists.forEach(function(item,index){item.houseTimeStap==data.houseTimeStap&&self.elevatorData.subHouseLists[index].elevatorLists.push(elevatorData)})},addElevatorWall:function(){$("body").on("click",".elevator-wall-item",function(){if(!$(this).hasClass("has-edit")){var houseTimeStap=$(this).attr("data-house-timestap"),elevatorTimeStap=$(this).attr("data-elevator-timestap"),index=$(this).attr("data-index"),text=$(this).text();layer.open({title:"编辑"+text,type:2,area:["600px","300px"],fix:!1,maxmin:!0,content:"addElevatorWall.hbs?houseTimeStap="+houseTimeStap+"&elevatorTimeStap="+elevatorTimeStap+"&index="+index})}})},addElevatorWallData:function(data){var self=this,houseTimeStap=data.houseTimeStap,elevatorTimeStap=data.elevatorTimeStap,wallIndex=data.index;console.log(self.elevatorData,data),self.elevatorData.subHouseLists.forEach(function(house,index){house.houseTimeStap==houseTimeStap&&house.elevatorLists.forEach(function(elevator,j){elevator.elevatorTimeStap==elevatorTimeStap&&elevator.wallLists.forEach(function(wall,m){wall.index==data.index&&(wall=_.extend(wall,data),$("#"+houseTimeStap+"-"+elevatorTimeStap+"-"+wallIndex).addClass("has-edit"))})})}),console.log(data)},submitElevator:function(){var self=this;$("#submitElevatorBtn").on("click",function(){$.ajax({url:self.url.addElevatorUrl,type:"get",data:self.elevatorData,dataType:"json",success:function(data){console.log(data)}})})}},app=new App})});